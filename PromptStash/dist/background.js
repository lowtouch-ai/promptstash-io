(()=>{function e(){const e="promptstash-sidebar";let t=document.getElementById(e);t?t.remove():(t=document.createElement("div"),t.id=e,t.innerHTML=`\n      <iframe src="${chrome.runtime.getURL("popup.html")}" style="width: 100%; height: 100%; border: none;"></iframe>\n    `,document.body.appendChild(t),chrome.storage.local.get(["isFullscreen"],(e=>{const n=e.isFullscreen||!1,o=window.innerWidth<=768,s=n||o?"100vw":"48vw",r=n||o?"100vh":"96vh",i=n||o?"0":window.innerWidth-.48*window.innerWidth-20+"px",a=n||o?"0":"20px";Object.assign(t.style,{width:s,height:r,position:"fixed",top:a,left:i,zIndex:"10000",backgroundColor:"#f5f5f5",border:"1px solid #88888844",borderRadius:n?"0":"8px",boxShadow:n?"none":"0 4px 12px rgba(0, 0, 0, 0.15)",overflow:"hidden",transition:"width 0.3s ease, height 0.3s ease, top 0.3s ease, left 0.3s ease"})})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&t&&t.remove()})),document.addEventListener("click",(e=>{t&&!t.contains(e.target)&&t.remove()})))}chrome.action.onClicked.addListener((t=>{t.url.startsWith("chrome://")?console.error("Cannot inject into chrome:// URLs"):chrome.scripting.executeScript({target:{tabId:t.id},function:e})})),chrome.runtime.onInstalled.addListener((()=>{chrome.contextMenus.create({id:"saveToPromptStash",title:"Save to PromptStash",contexts:["selection"]})})),chrome.contextMenus.onClicked.addListener(((e,t)=>{"saveToPromptStash"===e.menuItemId&&chrome.tabs.sendMessage(t.id,{action:"getSelectedText"},(e=>{e&&e.selectedText&&chrome.storage.local.get(["nextIndex"],(t=>{let n=t.nextIndex||0;chrome.storage.sync.get(["templates"],(t=>{const o=t.templates||[];let s="New Template 1",r=1;for(;o.some((e=>e.name===s));)s="New Template "+ ++r;const i=prompt(`Enter template details:\nName (required, default: ${s}):\nTags (optional, comma-separated):`,`${s}\n`);if(!i)return;const[a,c]=i.split("\n").map((e=>e.trim()));a&&(o.push({name:a,tags:c?c.replace(/[^a-zA-Z0-9, ]/g,"").replace(/\s*,\s*/g,", ").replace(/^,+\s*|,+\s*$/g,""):"",content:e.selectedText,type:"custom",favorite:!1,index:n++}),chrome.storage.sync.set({templates:o}),chrome.storage.local.set({nextIndex:n}))}))}))}))})),chrome.runtime.onMessage.addListener(((e,t,n)=>{"closeSidebar"===e.action?chrome.tabs.query({active:!0,currentWindow:!0},(e=>{chrome.scripting.executeScript({target:{tabId:e[0].id},function:()=>{const e=document.getElementById("promptstash-sidebar");e&&e.remove()}}),chrome.storage.local.set({isFullscreen:!1})})):"toggleFullscreen"===e.action&&chrome.storage.local.get(["isFullscreen"],(e=>{const t=!e.isFullscreen;chrome.storage.local.set({isFullscreen:t},(()=>{chrome.tabs.query({active:!0,currentWindow:!0},(e=>{chrome.scripting.executeScript({target:{tabId:e[0].id},function:e=>{const t=document.getElementById("promptstash-sidebar");if(t){const n=window.innerWidth<=768;Object.assign(t.style,{width:e||n?"100vw":"48vw",height:e||n?"100vh":"96vh",left:e||n?"0":window.innerWidth-.48*window.innerWidth-20+"px",top:e||n?"0":"20px",borderRadius:e?"0":"8px",boxShadow:e?"none":"0 4px 12px rgba(0, 0, 0, 0.15)",transition:"width 0.3s ease, height 0.3s ease, top 0.3s ease, left 0.3s ease",transform:"none"})}},args:[t]})}))}))}))}))})();