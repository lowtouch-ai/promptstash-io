(()=>{let o=null,e=null;function t(){chrome.system.display.getInfo((e=>{const t=e[0],r=t.workArea.width,n=t.workArea.height,a=t.workArea.left,d=t.workArea.top,l=a+Math.round((r-800)/2),i=d+Math.round((n-800)/2);chrome.windows.create({url:chrome.runtime.getURL("popup.html"),type:"popup",width:800,height:800,left:l,top:i,focused:!0},(e=>{o=e.id}))}))}chrome.action.onClicked.addListener((r=>{if(r.url.startsWith("chrome://"))return console.error("Cannot open window for chrome:// URLs"),void alert("Cannot open window for chrome:// URLs");e=r.id,null!==o?chrome.windows.get(o,{populate:!1},(e=>{chrome.runtime.lastError||!e?t():chrome.windows.update(o,{focused:!0})})):t()})),chrome.tabs.onActivated.addListener((o=>{chrome.tabs.get(o.tabId,(t=>{chrome.runtime.lastError||!t||t.url.startsWith("chrome://")?(console.log("Cannot set targetTabId to invalid or chrome:// tab"),e=null):(e=o.tabId,console.log("Updated targetTabId to:",e))}))})),chrome.tabs.onUpdated.addListener(((o,t,r)=>{"complete"===t.status&&r.active&&!r.url.startsWith("chrome://")&&(e=o,console.log("Updated targetTabId on tab update to:",e))})),chrome.windows.onRemoved.addListener((e=>{e===o&&(o=null)})),chrome.runtime.onMessage.addListener(((t,r,n)=>{"closePopup"===t.action&&t.windowId?chrome.windows.remove(t.windowId,(()=>{chrome.runtime.lastError&&console.error("Error closing window:",chrome.runtime.lastError)})):"getWindowId"===t.action?n({windowId:o}):"getTargetTabId"===t.action&&(null!==e?chrome.tabs.get(e,(o=>{chrome.runtime.lastError||!o||o.url.startsWith("chrome://")?(console.log("Invalid targetTabId, clearing"),e=null,n({tabId:null})):n({tabId:e})})):n({tabId:null}))}))})();