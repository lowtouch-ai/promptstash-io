(()=>{let e=null;function t(){chrome.windows.create({url:chrome.runtime.getURL("popup.html"),type:"popup",width:600,height:800,left:Math.round((window.screen.width-600)/2),top:Math.round((window.screen.height-800)/2),focused:!0},(t=>{e=t.id}))}chrome.action.onClicked.addListener((o=>{o.url.startsWith("chrome://")?console.error("Cannot open window for chrome:// URLs"):null!==e?chrome.windows.get(e,{populate:!1},(o=>{chrome.runtime.lastError||!o?t():chrome.windows.update(e,{focused:!0})})):t()})),chrome.windows.onRemoved.addListener((t=>{t===e&&(e=null,chrome.storage.local.set({isFullscreen:!1}))})),chrome.runtime.onInstalled.addListener((()=>{chrome.contextMenus.create({id:"saveToPromptStash",title:"Save to PromptStash",contexts:["selection"]})})),chrome.contextMenus.onClicked.addListener(((e,t)=>{"saveToPromptStash"===e.menuItemId&&chrome.tabs.sendMessage(t.id,{action:"getSelectedText"},(e=>{e&&e.selectedText&&chrome.storage.local.get(["nextIndex"],(t=>{let o=t.nextIndex||0;chrome.storage.sync.get(["templates"],(t=>{const r=t.templates||[];let n="New Template 1",s=1;for(;r.some((e=>e.name===n));)n="New Template "+ ++s;const c=prompt(`Enter template details:\nName (required, default: ${n}):\nTags (optional, comma-separated):`,`${n}\n`);if(!c)return;const[a,d]=c.split("\n").map((e=>e.trim()));a&&(r.push({name:a,tags:d?d.replace(/[^a-zA-Z0-9, ]/g,"").replace(/\s*,\s*/g,", ").replace(/^,+\s*|,+\s*$/g,""):"",content:e.selectedText,type:"custom",favorite:!1,index:o++}),chrome.storage.sync.set({templates:r}),chrome.storage.local.set({nextIndex:o}))}))}))}))})),chrome.runtime.onMessage.addListener(((t,o,r)=>{"closeSidebar"===t.action&&t.windowId?chrome.windows.remove(t.windowId,(()=>{chrome.runtime.lastError&&console.error("Error closing window:",chrome.runtime.lastError)})):"toggleFullscreen"===t.action&&t.windowId?chrome.storage.local.get(["isFullscreen"],(e=>{const o=!e.isFullscreen;chrome.storage.local.set({isFullscreen:o},(()=>{chrome.windows.get(t.windowId,{populate:!1},(e=>{e&&chrome.windows.update(t.windowId,{state:o?"maximized":"normal",width:o?e.width:600,height:o?e.height:800,left:o?e.left:Math.round((window.screen.width-600)/2),top:o?e.top:Math.round((window.screen.height-800)/2)})}))}))})):"getWindowId"===t.action&&r({windowId:e})}))})();