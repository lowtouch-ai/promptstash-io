(()=>{function e(){const e="promptstash-sidebar";let t=document.getElementById(e);if(t)t.remove();else{t=document.createElement("div"),t.id=e,t.innerHTML=`\n      <iframe src="${chrome.runtime.getURL("popup.html")}" style="width: 100%; height: 100%; border: none;"></iframe>\n    `,document.body.appendChild(t);const n=window.innerWidth<=768,o=n?"100vw":"48vw",i=n?"100vh":"96vh",s=n?"0":window.innerWidth-.48*window.innerWidth-20+"px",r=n?"0":"20px";Object.assign(t.style,{width:o,height:i,position:"fixed",top:r,left:s,zIndex:"10000",backgroundColor:"#f5f5f5",border:"1px solid #88888844",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",overflow:"hidden"});const d=document.createElement("div");d.style.position="absolute",d.style.top="0",d.style.left="0",d.style.width="100%",d.style.height="20px",d.style.cursor="move",t.appendChild(d);const a=document.createElement("div");a.style.position="absolute",a.style.bottom="0",a.style.right="0",a.style.width="10px",a.style.height="10px",a.style.cursor="se-resize",t.appendChild(a);let c,l,m,h,p=!1;d.addEventListener("mousedown",(e=>{n||(p=!0,c=e.clientX,l=e.clientY,m=parseFloat(t.style.left)||0,h=parseFloat(t.style.top)||0)})),document.addEventListener("mousemove",(e=>{if(!p)return;const n=e.clientX-c,o=e.clientY-l;t.style.left=`${Math.max(0,Math.min(m+n,window.innerWidth-t.offsetWidth))}px`,t.style.top=`${Math.max(0,Math.min(h+o,window.innerHeight-t.offsetHeight))}px`})),document.addEventListener("mouseup",(()=>{p=!1}));let u,x,g=!1;a.addEventListener("mousedown",(e=>{n||(g=!0,c=e.clientX,l=e.clientY,u=t.offsetWidth,x=t.offsetHeight,e.preventDefault())})),document.addEventListener("mousemove",(e=>{if(!g)return;const n=e.clientX-c,o=e.clientY-l;t.style.width=`${Math.max(200,u+n)}px`,t.style.height=`${Math.max(200,x+o)}px`})),document.addEventListener("mouseup",(()=>{g=!1})),window.addEventListener("resize",(()=>{const e=window.innerWidth<=768;Object.assign(t.style,{width:e?"100vw":"48vw",height:e?"100vh":"96vh",left:e?"0":window.innerWidth-.48*window.innerWidth-20+"px",top:e?"0":"20px"})})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&t&&t.remove()})),document.addEventListener("click",(e=>{t&&!t.contains(e.target)&&t.remove()}))}}chrome.action.onClicked.addListener((t=>{t.url.startsWith("chrome://")?console.error("Cannot inject into chrome:// URLs"):chrome.scripting.executeScript({target:{tabId:t.id},function:e})})),chrome.runtime.onInstalled.addListener((()=>{chrome.contextMenus.create({id:"saveToPromptStash",title:"Save to PromptStash",contexts:["selection"]})})),chrome.contextMenus.onClicked.addListener(((e,t)=>{"saveToPromptStash"===e.menuItemId&&chrome.tabs.sendMessage(t.id,{action:"getSelectedText"},(e=>{e&&e.selectedText&&chrome.storage.local.get(["nextIndex"],(t=>{let n=t.nextIndex||0;chrome.storage.sync.get(["templates"],(t=>{const o=t.templates||[];let i="New Template 1",s=1;for(;o.some((e=>e.name===i));)i="New Template "+ ++s;const r=prompt(`Enter template details:\nName (required, default: ${i}):\nTags (optional, comma-separated):`,`${i}\n`);if(!r)return;const[d,a]=r.split("\n").map((e=>e.trim()));d&&(o.push({name:d,tags:a?a.replace(/[^a-zA-Z0-9, ]/g,"").replace(/\s*,\s*/g,", ").replace(/^,+\s*|,+\s*$/g,""):"",content:e.selectedText,type:"custom",favorite:!1,index:n++}),chrome.storage.sync.set({templates:o}),chrome.storage.local.set({nextIndex:n}))}))}))}))})),chrome.runtime.onMessage.addListener(((e,t,n)=>{"closeSidebar"===e.action&&chrome.tabs.query({active:!0,currentWindow:!0},(e=>{chrome.scripting.executeScript({target:{tabId:e[0].id},function:()=>{const e=document.getElementById("promptstash-sidebar");e&&e.remove()}})}))}))})();