(()=>{let e=null,o=null;function t(){const o=Math.round(560),t=Math.round(140);chrome.windows.create({url:chrome.runtime.getURL("popup.html"),type:"popup",width:800,height:800,left:o,top:t,focused:!0},(o=>{e=o.id}))}chrome.action.onClicked.addListener((r=>{r.url.startsWith("chrome://")?console.error("Cannot open window for chrome:// URLs"):(o=r.id,null!==e?chrome.windows.get(e,{populate:!1},(o=>{chrome.runtime.lastError||!o?t():chrome.windows.update(e,{focused:!0})})):t())})),chrome.tabs.onActivated.addListener((e=>{chrome.tabs.get(e.tabId,(t=>{chrome.runtime.lastError||!t||t.url.startsWith("chrome://")?(console.log("Cannot set targetTabId to invalid or chrome:// tab"),o=null):(o=e.tabId,console.log("Updated targetTabId to:",o))}))})),chrome.tabs.onUpdated.addListener(((e,t,r)=>{"complete"===t.status&&r.active&&!r.url.startsWith("chrome://")&&(o=e,console.log("Updated targetTabId on tab update to:",o))})),chrome.windows.onRemoved.addListener((o=>{o===e&&(e=null,chrome.storage.local.set({isFullscreen:!1}))})),chrome.runtime.onMessage.addListener(((t,r,n)=>{"closePopup"===t.action&&t.windowId?chrome.windows.remove(t.windowId,(()=>{chrome.runtime.lastError&&console.error("Error closing window:",chrome.runtime.lastError)})):"toggleFullscreen"===t.action&&t.windowId?chrome.storage.local.get(["isFullscreen"],(e=>{const o=!e.isFullscreen;chrome.storage.local.set({isFullscreen:o},(()=>{chrome.windows.get(t.windowId,{populate:!1},(e=>{e&&chrome.windows.update(t.windowId,{state:o?"maximized":"normal",width:o?e.width:600,height:o?e.height:800,left:o?e.left:Math.round(660),top:o?e.top:Math.round(140)})}))}))})):"getWindowId"===t.action?n({windowId:e}):"getTargetTabId"===t.action&&(null!==o?chrome.tabs.get(o,(e=>{chrome.runtime.lastError||!e||e.url.startsWith("chrome://")?(console.log("Invalid targetTabId, clearing"),o=null,n({tabId:null})):n({tabId:o})})):n({tabId:null}))}))})();