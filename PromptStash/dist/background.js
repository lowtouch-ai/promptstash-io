(()=>{let o=null,t=null;function e(){const t=Math.round(560),e=Math.round(140);chrome.windows.create({url:chrome.runtime.getURL("popup.html"),type:"popup",width:800,height:800,left:t,top:e,focused:!0},(t=>{o=t.id}))}chrome.action.onClicked.addListener((r=>{r.url.startsWith("chrome://")?console.error("Cannot open window for chrome:// URLs"):(t=r.id,null!==o?chrome.windows.get(o,{populate:!1},(t=>{chrome.runtime.lastError||!t?e():chrome.windows.update(o,{focused:!0})})):e())})),chrome.tabs.onActivated.addListener((o=>{chrome.tabs.get(o.tabId,(e=>{chrome.runtime.lastError||!e||e.url.startsWith("chrome://")?(console.log("Cannot set targetTabId to invalid or chrome:// tab"),t=null):(t=o.tabId,console.log("Updated targetTabId to:",t))}))})),chrome.tabs.onUpdated.addListener(((o,e,r)=>{"complete"===e.status&&r.active&&!r.url.startsWith("chrome://")&&(t=o,console.log("Updated targetTabId on tab update to:",t))})),chrome.windows.onRemoved.addListener((t=>{t===o&&(o=null)})),chrome.runtime.onMessage.addListener(((e,r,n)=>{"closePopup"===e.action&&e.windowId?chrome.windows.remove(e.windowId,(()=>{chrome.runtime.lastError&&console.error("Error closing window:",chrome.runtime.lastError)})):"getWindowId"===e.action?n({windowId:o}):"getTargetTabId"===e.action&&(null!==t?chrome.tabs.get(t,(o=>{chrome.runtime.lastError||!o||o.url.startsWith("chrome://")?(console.log("Invalid targetTabId, clearing"),t=null,n({tabId:null})):n({tabId:t})})):n({tabId:null}))}))})();