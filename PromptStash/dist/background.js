(()=>{const e=["https://grok.com/","https://chatgpt.com/","https://www.perplexity.ai/","https://gemini.google.com/","https://claude.ai/"],t="grok.com, chatgpt.com, perplexity.ai, gemini.google.com, and claude.ai";function r(){let e=document.getElementById("promptstash-popup");e?(e.remove(),console.log("------------------- Pop-up closed -------------------")):(e=document.createElement("div"),e.id="promptstash-popup",e.innerHTML=`\n      <iframe src="${chrome.runtime.getURL("popup.html")}" style="width: 100%; height: 100%; border: none;"></iframe>\n    `,document.body.appendChild(e),e.style.userSelect="none",e.style.webkitUserSelect="none",console.log("------------------- Pop-up opened -------------------"),Array.from(e.querySelectorAll("*")).forEach((e=>{e.setAttribute("disabled","true"),e.style.pointerEvents="none"})),setTimeout((()=>{Array.from(e.querySelectorAll("*")).forEach((e=>{e.removeAttribute("disabled"),e.style.pointerEvents=""})),e.style.pointerEvents="auto"}),250),chrome.storage.local.get(["isFullscreen"],(t=>{const r=t.isFullscreen||!1,o=window.innerWidth<=768,s=r||o?"100vw":"50vw",n=r||o?"100vh":"96vh",i=r||o?"0":.49*window.innerWidth+"px",a=r||o?"0":"2vh";Object.assign(e.style,{width:s,height:n,position:"absolute",top:a,left:i,zIndex:"10000",backgroundColor:"none",border:"2px solid #8888",borderRadius:r?"0":"10px",boxShadow:r?"none":"0 4px 15px rgba(0, 0, 0, 0.2)",overflow:"hidden",transition:"width 0.3s ease, height 0.3s ease, top 0.3s ease, left 0.3s ease"})})),document.addEventListener("keydown",(t=>{"Escape"===t.key&&e&&e.remove()})),document.addEventListener("click",(t=>{e&&!e.contains(t.target)&&e.remove()})))}function o(e){let t=document.getElementById("promptstash-toast");t&&t.remove(),t=document.createElement("div"),t.id="promptstash-toast",t.className="promptstash-toast",t.textContent=e,document.body.appendChild(t),Object.assign(t.style,{position:"fixed",top:"20px",right:"20px",padding:"10px 20px",borderRadius:"6px",background:"#fdd",color:"#800",zIndex:"10001",opacity:"0",transform:"translateY(-20px)",transition:"opacity 0.3s ease, transform 0.3s ease"}),setTimeout((()=>{t.style.opacity="1",t.style.transform="translateY(0)"}),10),setTimeout((()=>{t.style.opacity="0",t.style.transform="translateY(-20px)",setTimeout((()=>t.remove()),300)}),3e3)}setInterval((()=>{chrome.tabs.query({active:!0,currentWindow:!0},(e=>{e[0]&&!e[0].url.match(/^(chrome|file|about):\/\//)&&chrome.tabs.sendMessage(e[0].id,{action:"ping"},(t=>{chrome.runtime.lastError&&chrome.scripting.executeScript({target:{tabId:e[0].id},files:["content.js"]},(()=>{chrome.runtime.lastError&&console.error("Periodic content script injection error:",chrome.runtime.lastError.message)}))}))}))}),3e5),chrome.action.onClicked.addListener((s=>s.url.match(/^(chrome|file|about):\/\//)?(console.error("Cannot inject into restricted URLs:",s.url),void chrome.scripting.executeScript({target:{tabId:s.id},function:o,args:[`PromptStash cannot be used on restricted URLs (e.g., chrome://, file://, about://). Please navigate to a supported AI platform (e.g., ${t.replace(", and ",", or ")}).`]})):e.some((e=>new RegExp(`^${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}.*`).test(s.url)))?void chrome.scripting.executeScript({target:{tabId:s.id},function:r},(()=>{chrome.runtime.lastError&&(console.error("Injection error:",chrome.runtime.lastError.message),chrome.scripting.executeScript({target:{tabId:s.id},function:o,args:["Failed to open PromptStash: "+chrome.runtime.lastError.message]}))})):(console.error("Tab URL not supported:",s.url),void chrome.scripting.executeScript({target:{tabId:s.id},function:o,args:[`PromptStash is only supported on ${t}. Please navigate to a supported site.`]})))),chrome.runtime.onMessage.addListener(((s,n,i)=>{if("closePopup"===s.action)chrome.tabs.query({active:!0,currentWindow:!0},(e=>{e[0]&&chrome.scripting.executeScript({target:{tabId:e[0].id},function:()=>{const e=document.getElementById("promptstash-popup");e&&e.remove()}},(()=>{chrome.runtime.lastError&&console.error("Close popup error:",chrome.runtime.lastError.message)}))}));else if("toggleFullscreen"===s.action)chrome.storage.local.get(["isFullscreen"],(e=>{const t=e.isFullscreen;chrome.tabs.query({active:!0,currentWindow:!0},(e=>{e[0]&&chrome.scripting.executeScript({target:{tabId:e[0].id},function:e=>{const t=document.getElementById("promptstash-popup");if(t){const r=window.innerWidth<=768;Object.assign(t.style,{width:e||r?"100vw":"50vw",height:e||r?"100vh":"96vh",left:e||r?"0":.49*window.innerWidth+"px",top:e||r?"0":"2vh",borderRadius:e?"0":"10px",boxShadow:e?"none":"0 4px 15px rgba(0, 0, 0, 0.2)",transition:"width 0.3s ease, height 0.3s ease, top 0.3s ease, left 0.3s ease"})}},args:[t]},(()=>{chrome.runtime.lastError&&console.error("Fullscreen toggle error:",chrome.runtime.lastError.message)}))}))}));else{if("getTargetTabId"===s.action)return chrome.tabs.query({active:!0,currentWindow:!0},(r=>{r[0]&&!r[0].url.match(/^(chrome|file|about):\/\//)?e.some((e=>new RegExp(`^${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}.*`).test(r[0].url)))?i({tabId:r[0].id}):(console.error("Tab URL not supported:",r[0].url),chrome.scripting.executeScript({target:{tabId:r[0].id},function:o,args:[`PromptStash is only supported on ${t}. Please navigate to a supported site.`]}),i({tabId:null})):(console.error("Restricted URL:",r[0]?.url||"No active tab"),chrome.scripting.executeScript({target:{tabId:r[0]?.id},function:o,args:[`PromptStash cannot be used on restricted URLs (e.g., chrome://, file://, about://). Please navigate to a supported AI platform (e.g., ${t.replace(", and ",", or ")}).`]}),i({tabId:null}))})),!0;if("reInjectContentScript"===s.action)return chrome.scripting.executeScript({target:{tabId:s.tabId},files:["content.js"]},(()=>{chrome.runtime.lastError?(console.error("Content script re-injection error:",chrome.runtime.lastError.message),i({success:!1})):i({success:!0})})),!0;"togglePopup"===s.action?chrome.storage.local.set({openWithSearch:!1},(()=>{chrome.tabs.query({active:!0,currentWindow:!0},(e=>{e[0]&&chrome.scripting.executeScript({target:{tabId:e[0].id},function:r})}))})):"ping"===s.action&&i({status:"alive"})}}))})();