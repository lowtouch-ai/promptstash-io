(()=>{"use strict";const e=[{name:"Business Analyst Report",tags:"analysis, report, business",type:"pre-built",content:"# Your Role\nBusiness Analyst\n\n# Your Task\nAnalyze the provided data and generate a concise report.\n\n# Relevant Background Information\nUse formal tone, focus on key metrics.\n\n# Output Format\nExecutive summary (200 words), followed by bullet points.",favorite:!1},{name:"Code Debugging Assistant",tags:"coding, debug, tech",type:"pre-built",content:"# Your Role\nSenior Developer\n\n# Your Task\nIdentify and fix bugs in the provided code snippet.\n\n# Relevant Background Information\nCode is in Python, prioritize efficiency.\n\n# Output Format\nExplanation of issue, corrected code block.",favorite:!1},{name:"Content Generator",tags:"marketing, content, quick",type:"pre-built",content:"# Your Role\nContent Writer\n\n# Your Task\nWrite a 500-word blog post on the given topic.\n\n# Relevant Background Information\nCasual tone, SEO-friendly.\n\n# Output Format\nTitle, intro, 3 sections, conclusion.",favorite:!1}],t="1.0.0";function n(e,t){let n;return function(...a){clearTimeout(n),n=setTimeout((()=>e.apply(this,a)),t)}}const a=(e,t)=>{let n=0;return function(...a){const o=Date.now();o-n>=t&&(n=o,e.apply(this,a))}};let o=[],s=!1,l=null,r=null;document.addEventListener("DOMContentLoaded",(()=>{const c={searchBox:document.getElementById("searchBox"),typeSelect:document.getElementById("typeSelect"),dropdownResults:document.getElementById("dropdownResults"),template:document.getElementById("template"),templateName:document.getElementById("templateName"),templateTags:document.getElementById("templateTags"),promptArea:document.getElementById("promptArea"),buttons:document.getElementById("buttons"),fetchBtns:document.querySelectorAll("#fetchBtn, #fetchBtn2"),fetchBtn2:document.getElementById("fetchBtn2"),saveBtn:document.getElementById("saveBtn"),saveAsBtn:document.getElementById("saveAsBtn"),deleteBtn:document.getElementById("deleteBtn"),clearSearch:document.getElementById("clearSearch"),clearPrompt:document.getElementById("clearPrompt"),clearAllBtn:document.getElementById("clearAllBtn"),sendBtn:document.getElementById("sendBtn"),favoriteSuggestions:document.getElementById("favoriteSuggestions"),fullscreenToggle:document.getElementById("fullscreenToggle"),closeBtn:document.getElementById("closeBtn"),minimizeBtn:document.getElementById("minimizeBtn"),newBtn:document.getElementById("newBtn"),overlay:document.getElementById("overlay"),toast:document.getElementById("toast"),themeToggle:document.getElementById("themeToggle")},i=Object.entries(c).filter((([e,t])=>!t)).map((([e])=>e));i.length>0?(console.error("Missing DOM elements:",i),T("Error: Extension UI failed to load. Please reload the extension.",3e3,"red")):console.log("All DOM elements found:",Object.keys(c));let m,d=null,u="light",p=null,g=0,v=!1,f=[];function y(){const e={popupState:{name:c.templateName.value,tags:c.templateTags.value,content:c.promptArea.value,selectedName:d},theme:u,isFullscreen:v,extensionVersion:t};chrome.storage.local.set(e)}function h(){chrome.storage.sync.set({nextIndex:g})}function E(){p={name:c.templateName.value,tags:c.templateTags.value,content:c.promptArea.value,selectedName:d,templates:null}}function T(e,t=4e3,n="red",a=[]){console.log("Queueing toast:",{message:e,duration:t,type:n,hasButtons:a.length>0}),o.push({message:e,duration:t,type:n,buttons:a}),s||B()}function b(e){console.log("Closing toast, clearing autoHideTimeout"),clearTimeout(l),l=null,r&&(document.removeEventListener("click",r),r=null,console.log("Outside click listener removed in closeToast")),c.toast.classList.remove("show"),c.toast.classList.add("hide"),setTimeout((()=>{c.toast.classList.remove("hide"),c.toast.innerHTML="",s=!1,console.log("Toast closed, executing callback:",!!e),e&&e(),setTimeout(B,100)}),300)}function B(){if(0===o.length)return s=!1,void console.log("No toasts in queue, stopping display");s=!0;const{message:e,duration:t,type:n,buttons:a}=o.shift();console.log("Displaying toast:",{message:e,duration:t,type:n,hasButtons:a.length>0}),c.toast.innerHTML=e;const i=document.createElement("button");if(i.textContent="Ã—",i.className="toast-close-btn",i.setAttribute("aria-label","Close toast"),i.addEventListener("click",(e=>{e.stopPropagation(),console.log("Close button clicked"),r&&(document.removeEventListener("click",r),r=null,console.log("Outside click listener removed on close button click"));const t=a.find((e=>"No"===e.text));b(t?.callback)})),c.toast.appendChild(i),a.length>0){const e=document.createElement("div");e.className="toast-button-container",a.forEach((({text:t,callback:n})=>{const a=document.createElement("button");a.textContent=t,a.className="toast-action-btn",a.setAttribute("aria-label","Yes"===t?"Confirm action":"Cancel action"),a.addEventListener("click",(e=>{e.stopPropagation(),console.log(`Confirmation button clicked: ${t}`),r&&(document.removeEventListener("click",r),r=null,console.log("Outside click listener removed on confirmation button click")),b(n)})),e.appendChild(a)})),c.toast.appendChild(e),r=e=>{if(!c.toast.contains(e.target)){console.log("Outside click detected");const e=a.find((e=>"No"===e.text));b((()=>{e&&e.callback&&e.callback()}))}},setTimeout((()=>{console.log("Attaching outside click listener"),document.addEventListener("click",r)}),50)}else console.log(`Setting auto-hide timeout for ${t}ms`),l=setTimeout((()=>{console.log("Auto-hide timeout triggered"),b()}),t);c.toast.className=`toast ${n} ${a.length>0?"confirmation":""}`,c.toast.classList.add("show")}function k(e,t,n=!1){const a=e.trim();if(!a)return T("Template name is required.",3e3,"red"),{isValid:!1,sanitizedName:null};if(a.length>50)return T("Template name must be 50 characters or less.",3e3,"red"),{isValid:!1,sanitizedName:null};const o=a.replace(/[^a-zA-Z0-9\s]/g,"");return o!==a?(T("Template name can only contain letters, numbers, and spaces.",3e3,"red"),{isValid:!1,sanitizedName:null}):t.some((e=>e.name===o&&(n||e.name!==d)))?(T("Template name must be unique.",3e3,"red"),{isValid:!1,sanitizedName:null}):{isValid:!0,sanitizedName:o}}function x(e){if(!e)return"";const t=e.split(",").map((e=>e.trim())).filter((e=>e));if(t.length>5)return T("Maximum of 5 tags allowed per template.",3e3,"red"),null;const n=t.map((e=>e.replace(/[^a-zA-Z0-9]/g,"").slice(0,20)));return n.some((e=>0===e.length))?(T("Each tag must contain only letters or numbers and be 20 characters or less.",3e3,"red"),null):n.join(", ")}function A(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"")}function L(e){f.unshift(e),f=[...new Set(f)],f.length>10&&(f=f.slice(0,10)),chrome.storage.sync.set({recentIndices:f},(()=>{chrome.runtime.lastError&&console.error("Failed to save recent indices:",chrome.runtime.lastError.message)}))}chrome.storage.local.get(["popupState","theme","extensionVersion"],(n=>{chrome.storage.sync.get(["recentIndices","templates","nextIndex"],(a=>{const o=n.extensionVersion||"0.0.0";o!==t&&(console.log(`Version updated from ${o} to ${t}. No schema migration needed.`),chrome.storage.local.set({extensionVersion:t}));const s=n.popupState||{};c.templateName.value=s.name||"",c.templateTags.value=s.tags||"",c.promptArea.value=s.content||"",d=s.selectedName||null,u=n.theme||"light",g=a.nextIndex||e.length,f=a.recentIndices||[];const l=a.templates||e.map(((e,t)=>({...e,index:t})));a.templates||chrome.storage.sync.set({templates:l}),document.body.className=u,c.fetchBtn2.style.display=c.promptArea.value?"none":"block",I(c.typeSelect.value,"",!1)}))})),new ResizeObserver((()=>{clearTimeout(m),m=setTimeout((()=>{const e=document.body.clientWidth,t=Math.min(Math.max(e/20,14),24);document.documentElement.style.setProperty("--base-font-size",`${t}px`)}),100)})).observe(document.body),c.templateName.addEventListener("input",n((()=>{let e=c.templateName.value;e.length>50&&(e=e.slice(0,50),c.templateName.value=e);const t=e.replace(/[^a-zA-Z0-9\s]/g,"");t!==e&&(c.templateName.value=t,T("Template name can only contain letters, numbers, and spaces.",3e3,"red")),y()}),10)),c.templateTags.addEventListener("input",n((()=>{E();let e=c.templateTags.value;if(e){e=e.replace(/^[,\s]+/g,""),e=e.replace(/,[,\s]*/g,", "),e=e.replace(/\s+/g," ");const t=e.split(", ").map((e=>e.replace(/[^a-zA-Z0-9]/g,"").slice(0,20)));t.length>5&&(T("Maximum of 5 tags allowed per template.",3e3,"red"),t.length=5),e=t.join(", "),c.templateTags.value=e}const t=c.templateTags.selectionStart;" "===e[t]&&","===e[t-1]&&(c.templateTags.selectionStart=c.templateTags.selectionEnd=t-1),y()}),10)),c.themeToggle.addEventListener("click",(()=>{u="light"===u?"dark":"light",document.body.className=u,y()})),c.fullscreenToggle.addEventListener("click",(()=>{c.fullscreenToggle.querySelector("svg use").setAttribute("href",v?"sprite.svg#compress":"sprite.svg#fullscreen"),v=!v,y(),chrome.runtime.sendMessage({action:"toggleFullscreen"})})),c.minimizeBtn.addEventListener("click",(()=>{chrome.runtime.sendMessage({action:"closePopup"})})),c.closeBtn.addEventListener("click",(()=>{c.templateName.value="",c.templateTags.value="",c.promptArea.value="",d=null,c.fetchBtn2.style.display="block",c.searchBox.value="",I(c.typeSelect.value,"",!1),y(),chrome.runtime.sendMessage({action:"closePopup"})}));const w=a(((e,t,n)=>{T(e,t,n)}),2e3);c.newBtn.addEventListener("click",(()=>{E(),c.templateName.value="",c.templateTags.value="",c.promptArea.value="",d=null,c.fetchBtn2.style.display="block",c.searchBox.value="",I(c.typeSelect.value,"",!1),y(),w("New template created.",3e3,"green")})),c.clearSearch.addEventListener("click",(()=>{c.searchBox.value="",I(c.typeSelect.value,"",!1),c.searchBox.focus()})),c.clearPrompt.addEventListener("click",(()=>{E(),c.promptArea.value="",c.fetchBtn2.style.display="block",c.promptArea.focus(),y()}));const S=a(((e,t,n)=>{T(e,t,n)}),2e3);function N(e){const t=setTimeout((()=>{T("Error: No response from tab. Please activate a supported webpage.",3e3,"red"),e(null)}),5e3);chrome.runtime.sendMessage({action:"getTargetTabId"},(n=>{clearTimeout(t),n&&n.tabId?e(n.tabId):(T("Error: No valid tab selected. Please activate a supported webpage.",3e3,"red"),e(null))}))}function I(t,n="",a=!1){chrome.storage.sync.get(["templates"],(o=>{console.log(o);let s=o.templates||e.map(((e,t)=>({...e,index:t})));c.dropdownResults.innerHTML="",c.favoriteSuggestions.innerHTML="";let l=s.filter((e=>"all"===t||e.type===t));n?(l=l.filter((e=>e.name.toLowerCase().includes(n)||e.tags.toLowerCase().includes(n))),l.sort(((e,t)=>{const a=e.name.toLowerCase().indexOf(n)+e.tags.toLowerCase().indexOf(n),o=t.name.toLowerCase().indexOf(n)+t.tags.toLowerCase().indexOf(n);return a!==o?a-o:e.name.localeCompare(t.name)}))):l.sort(((e,t)=>{const n=f.indexOf(e.index),a=f.indexOf(t.index);return-1===n&&-1===a?e.name.localeCompare(t.name):-1===n?1:-1===a?-1:n-a})),a&&l.forEach(((e,t)=>{const n=document.createElement("div");n.textContent=(e.favorite,`${e.name} (${e.tags})`),n.setAttribute("role","option"),n.setAttribute("aria-selected",d===e.name),c.overlay.style.display="block",c.dropdownResults.style.display="block",c.dropdownResults.classList.add("show"),n.addEventListener("click",(t=>{t.target.classList.contains("favorite-toggle")||(d=e.name,c.templateName.value=e.name,c.templateTags.value=e.tags,c.promptArea.value=e.content,c.searchBox.value="",c.dropdownResults.innerHTML="",c.fetchBtn2.style.display=e.content?"none":"block",c.overlay.style.display="none",c.dropdownResults.style.display="none",c.dropdownResults.classList.remove("show"),y(),c.promptArea.focus())})),n.innerHTML+=`<button class="favorite-toggle ${e.favorite?"favorited":"unfavorited"}" data-name="${e.name}" aria-label="${e.favorite?"Unfavorite":"Favorite"} template">${e.favorite?"â˜…":"â˜†"}</button>`,c.dropdownResults.appendChild(n)}));const r=s.filter((e=>e.favorite));r.length>0?(r.sort(((e,t)=>{const n=f.indexOf(e.index),a=f.indexOf(t.index);return-1===n&&-1===a?e.name.localeCompare(t.name):-1===n?1:-1===a?-1:n-a})),c.favoriteSuggestions.classList.remove("d-none"),r.forEach((e=>{const t=document.createElement("span");t.textContent=e.name,t.className="favorite-suggestion",t.setAttribute("role","button"),t.setAttribute("tabindex","0"),t.addEventListener("click",(()=>{d=e.name,c.templateName.value=e.name,c.templateTags.value=e.tags,c.promptArea.value=e.content,c.searchBox.value="",c.fetchBtn2.style.display=e.content?"none":"block",y(),c.promptArea.focus()})),t.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||t.click()})),c.favoriteSuggestions.appendChild(t)}))):c.favoriteSuggestions.classList.add("d-none")}))}function C(e,t,n=!1){!function(e){chrome.storage.sync.get(null,(t=>{const n=JSON.stringify(t);(new TextEncoder).encode(n).length>92160&&T("Warning: Storage is nearly full (90% of 100KB limit). Please delete unused templates.",5e3,"red"),e()}))}((()=>{chrome.storage.sync.set({templates:e},(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message;e.includes("QUOTA_BYTES_PER_ITEM")?T("Template size exceeds 8KB limit. Please reduce the size.",3e3,"red"):e.includes("QUOTA_BYTES")?T("Total storage limit (100KB) exceeded. Please delete unused templates.",3e3,"red"):T("Failed to save template: "+e,3e3,"red"),console.error("Sync storage error:",e)}else T(n?"Template saved. Press Ctrl+Z to undo.":"Template updated. Press Ctrl+Z to undo.",3e3,"green"),t()}))}))}function P(t,n){chrome.storage.sync.get(["templates"],(a=>{let o=a.templates||e.map(((e,t)=>({...e,index:t})));E(),p.templates=[...o];const s={name:t,tags:n,content:A(c.promptArea.value),type:"custom",favorite:!1,index:g};o.push(s),L(g),g++,C(o,(()=>{d=t,c.templateName.value=t,I(c.typeSelect.value,"",!1),y(),h()}),!0)}))}let M;c.clearAllBtn.addEventListener("click",(()=>{E(),c.templateName.value="",c.templateTags.value="",c.promptArea.value="",d=null,c.fetchBtn2.style.display="block",c.searchBox.value="",I(c.typeSelect.value,"",!1),y(),S("All fields cleared.",3e3,"green")})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&chrome.runtime.sendMessage({action:"closePopup"})})),c.promptArea.addEventListener("keydown",(e=>{if("Tab"===e.key){e.preventDefault();const t=c.promptArea.selectionStart,n=c.promptArea.selectionEnd,a=c.promptArea.value;c.promptArea.value=a.substring(0,t)+"  "+a.substring(n),c.promptArea.selectionStart=c.promptArea.selectionEnd=t+2,y()}})),c.promptArea.addEventListener("input",(()=>{E(),c.promptArea.value=A(c.promptArea.value),c.fetchBtn2.style.display=c.promptArea.value?"none":"block",y()})),c.templateTags.addEventListener("keydown",(e=>{const t=c.templateTags.selectionStart,n=c.templateTags.value;return"Backspace"===e.key&&t>0&&" "===n[t-1]&&","===n[t-2]?(e.preventDefault(),c.templateTags.value=n.slice(0,t-2)+n.slice(t),c.templateTags.selectionStart=c.templateTags.selectionEnd=t-2,E(),void y()):"Delete"===e.key&&t<n.length&&","===n[t]&&" "===n[t+1]?(e.preventDefault(),c.templateTags.value=n.slice(0,t)+n.slice(t+2),c.templateTags.selectionStart=c.templateTags.selectionEnd=t,E(),void y()):"ArrowLeft"===e.key&&t>1&&" "===n[t-1]&&","===n[t-2]?(e.preventDefault(),void(c.templateTags.selectionStart=c.templateTags.selectionEnd=t-2)):"ArrowRight"===e.key&&t<n.length-1&&","===n[t]&&" "===n[t+1]?(e.preventDefault(),void(c.templateTags.selectionStart=c.templateTags.selectionEnd=t+2)):void 0})),c.templateTags.addEventListener("click",(()=>{const e=c.templateTags.selectionStart,t=c.templateTags.value;e>0&&" "===t[e]&&","===t[e-1]&&(c.templateTags.selectionStart=c.templateTags.selectionEnd=e-1)})),c.searchBox.addEventListener("focus",(()=>{I(c.typeSelect.value,c.searchBox.value.toLowerCase(),!0)})),c.searchBox.addEventListener("input",(()=>{I(c.typeSelect.value,c.searchBox.value.toLowerCase(),!0)})),c.typeSelect.addEventListener("change",(()=>{I(c.typeSelect.value,c.searchBox.value.toLowerCase(),!0)})),document.addEventListener("click",(e=>{c.searchBox.contains(e.target)||c.dropdownResults.contains(e.target)||c.themeToggle.contains(e.target)||c.typeSelect.contains(e.target)||(c.dropdownResults.innerHTML="",c.overlay.style.display="none",c.dropdownResults.style.display="none",c.dropdownResults.classList.remove("show"))})),c.saveBtn.addEventListener("click",(()=>{chrome.storage.sync.get(["templates"],(t=>{let n=t.templates||e.map(((e,t)=>({...e,index:t})));const a=k(c.templateName.value,n);if(!a.isValid)return void c.templateName.focus();const o=a.sanitizedName,s=c.templateTags.value,l=x(s);if(null===l)return void c.templateTags.focus();const r=A(c.promptArea.value);if(!r.trim())return T("Prompt content is required to save a template.",3e3,"red"),void c.promptArea.focus();if(!s.trim())return c.templateTags.focus(),void T("No tags provided. Save without tags?",0,"red",[{text:"Yes",callback:()=>{if(d){const e=n.find((e=>e.name===d));if(!e)return void T("Selected template not found.",3e3,"red");if(c.templateName.value===e.name&&x(c.templateTags.value)===e.tags&&c.promptArea.value===e.content)return void T("No changes to save.",3e3,"red");E(),p.templates=[...n];const t=n.findIndex((e=>e.name===d));n[t]={name:o,tags:l,content:r,type:"custom",favorite:e.favorite||!1,index:e.index},C(n,(()=>{d=o,I(c.typeSelect.value,"",!1),y()}))}else{E(),p.templates=[...n];const e={name:o,tags:l,content:r,type:"custom",favorite:!1,index:g};n.push(e),L(g),g++,C(n,(()=>{d=o,I(c.typeSelect.value,"",!1),y(),h()}),!0)}}},{text:"No",callback:()=>{c.templateTags.focus()}}]);if(d){const e=n.find((e=>e.name===d));if(!e)return void T("Selected template not found.",3e3,"red");if(c.templateName.value===e.name&&x(c.templateTags.value)===e.tags&&c.promptArea.value===e.content)return void T("No changes to save.",3e3,"red");E(),p.templates=[...n];const t=n.findIndex((e=>e.name===d));n[t]={name:o,tags:l,content:r,type:"custom",favorite:e.favorite||!1,index:e.index},C(n,(()=>{d=o,I(c.typeSelect.value,"",!1),y()}))}else{E(),p.templates=[...n];const e={name:o,tags:l,content:r,type:"custom",favorite:!1,index:g};n.push(e),L(g),g++,C(n,(()=>{d=o,I(c.typeSelect.value,"",!1),y(),h()}),!0)}}))})),c.saveAsBtn.addEventListener("click",(()=>{chrome.storage.sync.get(["templates"],(t=>{const n=t.templates||e.map(((e,t)=>({...e,index:t}))),a=k(c.templateName.value,n,!0);if(!a.isValid)return void c.templateName.focus();const o=a.sanitizedName,s=c.templateTags.value,l=x(s);if(null!==l)return A(c.promptArea.value).trim()?s.trim()?void P(o,l):(c.templateTags.focus(),void T("No tags provided. Save without tags?",0,"red",[{text:"Yes",callback:()=>{P(o,l)}},{text:"No",callback:()=>{c.templateTags.focus()}}])):(T("Prompt content is required to save a template.",3e3,"red"),void c.promptArea.focus());c.templateTags.focus()}))})),c.fetchBtns.forEach((e=>{e.addEventListener("click",(()=>{N((e=>{e?chrome.tabs.sendMessage(e,{action:"getPrompt"},(e=>{if(chrome.runtime.lastError)return console.error("Fetch error:",chrome.runtime.lastError.message),void T("Failed to fetch prompt. Please refresh the page.",3e3,"red");e&&e.prompt?(E(),c.promptArea.value=A(e.prompt),c.fetchBtn2.style.display="none",y()):T("No input found on the page.",3e3,"red")})):T("Error: No valid tab selected. Please activate a supported webpage.",3e3,"red")}))}))})),c.sendBtn.addEventListener("click",(()=>{N((t=>{t?chrome.tabs.sendMessage(t,{action:"sendPrompt",prompt:A(c.promptArea.value)},(t=>{if(chrome.runtime.lastError)return console.error("Send error:",chrome.runtime.lastError.message),void T("Failed to send prompt. Please refresh the page.",3e3,"red");t&&t.success?d?chrome.storage.sync.get(["templates"],(t=>{const n=(t.templates||e.map(((e,t)=>({...e,index:t})))).find((e=>e.name===d));n&&L(n.index),chrome.runtime.sendMessage({action:"closePopup"})})):chrome.runtime.sendMessage({action:"closePopup"}):T("Failed to send prompt. Please refresh the page.",3e3,"red")})):T("Error: No valid tab selected. Please activate a supported webpage.",3e3,"red")}))})),c.deleteBtn.addEventListener("click",(()=>{d?chrome.storage.sync.get(["templates","recentIndices"],(t=>{const n=t.templates||e.map(((e,t)=>({...e,index:t}))),a="pre-built"===n.find((e=>e.name===d)).type;T(`Are you sure you want to delete "${d}"?${a?"<br>This is a pre-built template.":""}`,0,"red",[{text:"Yes",callback:()=>{E(),p.templates=[...n];const e=n.findIndex((e=>e.name===d)),t=n[e].index;n.splice(e,1),f=f.filter((e=>e!==t)),chrome.storage.sync.set({templates:n,recentIndices:f},(()=>{chrome.runtime.lastError?T("Failed to delete template: "+chrome.runtime.lastError.message,3e3,"red"):(T("Template deleted successfully. Press Ctrl+Z to undo.",3e3,"green"),d=null,c.templateName.value="",c.templateTags.value="",c.promptArea.value="",c.searchBox.value="",c.fetchBtn2.style.display="block",I(c.typeSelect.value,"",!1),y())}))}},{text:"No",callback:()=>{}}])})):T("Please select a template to delete.",3e3,"red")})),document.addEventListener("keydown",(e=>{e.ctrlKey&&"z"===e.key&&p&&(c.templateName.value=p.name||"",c.templateTags.value=p.tags||"",c.promptArea.value=p.content||"",d=p.selectedName||null,p.templates&&chrome.storage.sync.set({templates:p.templates},(()=>{I(c.typeSelect.value,"",!1)})),c.fetchBtn2.style.display=c.promptArea.value?"none":"block",T("Action undone successfully.",3e3,"green"),p=null,y())})),document.addEventListener("click",(t=>{if(t.target.classList.contains("favorite-toggle")){const n=t.target.dataset.name;chrome.storage.sync.get(["templates"],(t=>{const a=t.templates||e.map(((e,t)=>({...e,index:t}))),o=a.find((e=>e.name===n));if(o){if(!o.favorite&&a.filter((e=>e.favorite)).length>=10)return void T("Maximum of 10 favorite templates allowed.",3e3,"red");o.favorite=!o.favorite,chrome.storage.sync.set({templates:a},(()=>{I(c.typeSelect.value,c.searchBox.value.toLowerCase(),!0)}))}}))}})),document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach((e=>new bootstrap.Tooltip(e,{delay:{show:500,hide:50}}))),c.dropdownResults.addEventListener("keydown",(e=>{const t=c.dropdownResults.querySelectorAll("div"),n=document.activeElement;let a=Array.from(t).indexOf(n);"ArrowDown"===e.key?(e.preventDefault(),a=(a+1)%t.length,t[a].focus()):"ArrowUp"===e.key?(e.preventDefault(),a=(a-1+t.length)%t.length,t[a].focus()):"Enter"===e.key&&(e.preventDefault(),n.click())})),document.addEventListener("mousemove",(()=>{clearTimeout(M),M=setTimeout((()=>{c.clearSearch.style.display=c.searchBox.value?"block":"none",c.clearPrompt.style.display=c.promptArea.value?"block":"none"}),50)}))}))})();