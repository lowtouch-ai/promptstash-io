(()=>{function e(e,t,n){if("sendPrompt"===e.action)t?("DIV"===t.tagName&&"true"===t.contentEditable?t.innerHTML=e.prompt.replace(/\n/g,"<br>"):t.value=e.prompt,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),t.focus()):console.log("No input field found for sendPrompt"),n({success:!!t});else if("getPrompt"===e.action)if(t){let e;e="DIV"===t.tagName&&"true"===t.contentEditable?t.innerHTML.replace(/<br\s*\/?>/gi,"\n").replace(/<\/?[^>]+(>|$)/g,""):t.value||"",n({prompt:e})}else console.log("No input field found for getPrompt"),n({prompt:""});else"getSelectedText"===e.action&&n({selectedText:window.getSelection().toString()})}chrome.runtime.onMessage.addListener(((t,n,o)=>{let a=document.querySelector("[contenteditable='true'][role='textbox'], textarea:not([disabled]), input[type='text']:not([disabled]), [contenteditable='true'][aria-label*='prompt' i], textarea[aria-label*='prompt' i], input[aria-label*='prompt' i]");if(!a&&("sendPrompt"===t.action||"getPrompt"===t.action))return setTimeout((()=>{a=document.querySelector("[contenteditable='true'][role='textbox'], textarea:not([disabled]), input[type='text']:not([disabled]), [contenteditable='true'][aria-label*='prompt' i], textarea[aria-label*='prompt' i], input[aria-label*='prompt' i]"),e(t,a,o)}),500),!0;e(t,a,o)})),document.addEventListener("click",(e=>{const t=document.getElementById("promptstash-popup");t&&!t.contains(e.target)&&chrome.runtime.sendMessage({action:"closePopup"})}))})();