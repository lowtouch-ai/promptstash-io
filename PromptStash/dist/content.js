chrome.runtime.onMessage.addListener(((e,t,n)=>{let o;if(o=window.location.hostname.includes("chatgpt.com")?document.querySelector("div[contenteditable='true']"):document.querySelector("textarea, input[type='text']"),"sendPrompt"===e.action)o?("DIV"===o.tagName&&"true"===o.contentEditable?o.innerHTML=e.prompt.replace(/\n/g,"<br>"):o.value=e.prompt,o.dispatchEvent(new Event("input",{bubbles:!0})),o.focus()):console.log("No input field found for sendPrompt"),n({success:!!o});else if("getPrompt"===e.action)if(o){let e;e="DIV"===o.tagName&&"true"===o.contentEditable?o.innerHTML.replace(/<br\s*\/?>/gi,"\n").replace(/<\/?[^>]+(>|$)/g,""):o.value||"",n({prompt:e})}else n({prompt:""});else"getSelectedText"===e.action&&n({selectedText:window.getSelection().toString()})})),window.addEventListener("message",(e=>{if("closeSidebar"===e.data.action){const e=document.getElementById("promptstash-sidebar");e&&e.remove()}else if("loadFullscreen"===e.data.action){const e=document.getElementById("promptstash-sidebar");e&&(e.querySelector("iframe").src=chrome.runtime.getURL("fullscreen.html"))}else if("loadPopup"===e.data.action){const e=document.getElementById("promptstash-sidebar");e&&(e.querySelector("iframe").src=chrome.runtime.getURL("popup.html"))}})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&chrome.runtime.sendMessage({action:"closeSidebar"})})),document.addEventListener("click",(e=>{const t=document.getElementById("promptstash-sidebar");t&&!t.contains(e.target)&&chrome.runtime.sendMessage({action:"closeSidebar"})}));